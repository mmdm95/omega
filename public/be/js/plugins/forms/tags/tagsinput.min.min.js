!function(r){function q(a,d){this.isInit=!0,this.itemsArray=[],this.$element=r(a),this.$element.hide(),this.isSelect="SELECT"===a.tagName,this.multiple=this.isSelect&&a.hasAttribute("multiple"),this.objectItems=d&&d.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=r('<div class="bootstrap-tagsinput"></div>'),this.$input=r('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(d),this.isInit=!1}function p(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(b){return b[f]}}}function o(e,d){if("function"!=typeof e[d]){var f=e[d];e[d]=function(){return f}}}function n(b){return b?j.text(b).html():""}function m(e){var d=0;if(document.selection){e.focus();var f=document.selection.createRange();f.moveStart("character",-e.value.length),d=f.text.length}else{(e.selectionStart||"0"==e.selectionStart)&&(d=e.selectionStart)}return d}function l(a,f){var e=!1;return r.each(f,function(b,s){if("number"==typeof s&&a.which===s){return e=!0,!1}if(a.which===s.which){var i=!s.hasOwnProperty("altKey")||a.altKey===s.altKey,h=!s.hasOwnProperty("shiftKey")||a.shiftKey===s.shiftKey,d=!s.hasOwnProperty("ctrlKey")||a.ctrlKey===s.ctrlKey;if(i&&h&&d){return e=!0,!1}}}),e}var k={tagClass:function(b){return"label label-info"},focusClass:"focus",itemValue:function(b){return b?b.toString():b},itemText:function(b){return this.itemValue(b)},itemTitle:function(b){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(d,c){c.hide().fadeIn()},trimValue:!1,allowDuplicates:!1,triggerChange:!0};q.prototype={constructor:q,add:function(G,F,E){var D=this;if(!(D.options.maxTags&&D.itemsArray.length>=D.options.maxTags)&&(G===!1||G)){if("string"==typeof G&&D.options.trimValue&&(G=r.trim(G)),"object"==typeof G&&!D.objectItems){throw"Can't add objects when itemValue option is not set"}if(!G.toString().match(/^\s*$/)){if(D.isSelect&&!D.multiple&&D.itemsArray.length>0&&D.remove(D.itemsArray[0]),"string"==typeof G&&"INPUT"===this.$element[0].tagName){var C=D.options.delimiterRegex?D.options.delimiterRegex:D.options.delimiter,B=G.split(C);if(B.length>1){for(var A=0;A<B.length;A++){this.add(B[A],!0)}return void (F||D.pushVal(D.options.triggerChange))}}var z=D.options.itemValue(G),y=D.options.itemText(G),x=D.options.tagClass(G),w=D.options.itemTitle(G),v=r.grep(D.itemsArray,function(b){return D.options.itemValue(b)===z})[0];if(!v||D.options.allowDuplicates){if(!(D.items().toString().length+G.length+1>D.options.maxInputLength)){var u=r.Event("beforeItemAdd",{item:G,cancel:!1,options:E});if(D.$element.trigger(u),!u.cancel){D.itemsArray.push(G);var t=r('<span class="tag '+n(x)+(null!==w?'" title="'+w:"")+'">'+n(y)+'<span data-role="remove"></span></span>');t.data("item",G),D.findInputWrapper().before(t),t.after(" ");var e=r('option[value="'+encodeURIComponent(z)+'"]',D.$element).length||r('option[value="'+n(z)+'"]',D.$element).length;if(D.isSelect&&!e){var a=r("<option selected>"+n(y)+"</option>");a.data("item",G),a.attr("value",z),D.$element.append(a)}F||D.pushVal(D.options.triggerChange),(D.options.maxTags===D.itemsArray.length||D.items().toString().length===D.options.maxInputLength)&&D.$container.addClass("bootstrap-tagsinput-max"),r(".typeahead, .twitter-typeahead",D.$container).length&&D.$input.typeahead("val",""),this.isInit?D.$element.trigger(r.Event("itemAddedOnInit",{item:G,options:E})):D.$element.trigger(r.Event("itemAdded",{item:G,options:E}))}}}else{if(D.options.onTagExists){var H=r(".tag",D.$container).filter(function(){return r(this).data("item")===v});D.options.onTagExists(G,H)}}}}},remove:function(a,s,i){var h=this;if(h.objectItems&&(a="object"==typeof a?r.grep(h.itemsArray,function(b){return h.options.itemValue(b)==h.options.itemValue(a)}):r.grep(h.itemsArray,function(b){return h.options.itemValue(b)==a}),a=a[a.length-1]),a){var g=r.Event("beforeItemRemove",{item:a,cancel:!1,options:i});if(h.$element.trigger(g),g.cancel){return}r(".tag",h.$container).filter(function(){return r(this).data("item")===a}).remove(),r("option",h.$element).filter(function(){return r(this).data("item")===a}).remove(),-1!==r.inArray(a,h.itemsArray)&&h.itemsArray.splice(r.inArray(a,h.itemsArray),1)}s||h.pushVal(h.options.triggerChange),h.options.maxTags>h.itemsArray.length&&h.$container.removeClass("bootstrap-tagsinput-max"),h.$element.trigger(r.Event("itemRemoved",{item:a,options:i}))},removeAll:function(){var a=this;for(r(".tag",a.$container).remove(),r("option",a.$element).remove();a.itemsArray.length>0;){a.itemsArray.pop()}a.pushVal(a.options.triggerChange)},refresh:function(){var a=this;r(".tag",a.$container).each(function(){var v=r(this),u=v.data("item"),t=a.options.itemValue(u),s=a.options.itemText(u),e=a.options.tagClass(u);if(v.attr("class",null),v.addClass("tag "+n(e)),v.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(s),a.isSelect){var b=r("option",a.$element).filter(function(){return r(this).data("item")===u});b.attr("value",t)}})},items:function(){return this.itemsArray},pushVal:function(){var a=this,d=r.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(d,!0),a.options.triggerChange&&a.$element.trigger("change")},build:function(a){var h=this;if(h.options=r.extend({},k,a),h.objectItems&&(h.options.freeInput=!1),p(h.options,"itemValue"),p(h.options,"itemText"),o(h.options,"tagClass"),h.options.typeahead){var g=h.options.typeahead||{};o(g,"source"),h.$input.typeahead(r.extend({},g,{source:function(e,u){function t(w){for(var v=[],y=0;y<w.length;y++){var x=h.options.itemText(w[y]);s[x]=w[y],v.push(x)}u(v)}this.map={};var s=this.map,i=g.source(e);r.isFunction(i.success)?i.success(t):r.isFunction(i.then)?i.then(t):r.when(i).then(t)},updater:function(b){return h.add(this.map[b]),this.map[b]},matcher:function(b){return -1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(i){var e=new RegExp("("+this.query+")","gi");return i.replace(e,"<strong>$1</strong>")}}))}if(h.options.typeaheadjs){var f=null,d={},c=h.options.typeaheadjs;r.isArray(c)?(f=c[0],d=c[1]):d=c,h.$input.typeahead(f,d).on("typeahead:selected",r.proxy(function(i,e){d.valueKey?h.add(e[d.valueKey]):h.add(e),h.$input.typeahead("val","")},h))}h.$container.on("click",r.proxy(function(b){h.$element.attr("disabled")||h.$input.removeAttr("disabled"),h.$input.focus()},h)),h.options.addOnBlur&&h.options.freeInput&&h.$input.on("focusout",r.proxy(function(e){0===r(".typeahead, .twitter-typeahead",h.$container).length&&(h.add(h.$input.val()),h.$input.val(""))},h)),h.$container.on({focusin:function(){h.$container.addClass(h.options.focusClass)},focusout:function(){h.$container.removeClass(h.options.focusClass)}}),h.$container.on("keydown","input",r.proxy(function(e){var y=r(e.target),x=h.findInputWrapper();if(h.$element.attr("disabled")){return void h.$input.attr("disabled","disabled")}switch(e.which){case 8:if(0===m(y[0])){var w=x.prev();w.length&&h.remove(w.data("item"))}break;case 46:if(0===m(y[0])){var v=x.next();v.length&&h.remove(v.data("item"))}break;case 37:var u=x.prev();0===y.val().length&&u[0]&&(u.before(x),y.focus());break;case 39:var t=x.next();0===y.val().length&&t[0]&&(t.after(x),y.focus())}var s=y.val().length;Math.ceil(s/5);y.attr("size",Math.max(this.inputSize,y.val().length))},h)),h.$container.on("keypress","input",r.proxy(function(e){var u=r(e.target);if(h.$element.attr("disabled")){return void h.$input.attr("disabled","disabled")}var t=u.val(),s=h.options.maxChars&&t.length>=h.options.maxChars;h.options.freeInput&&(l(e,h.options.confirmKeys)||s)&&(0!==t.length&&(h.add(s?t.substr(0,h.options.maxChars):t),u.val("")),h.options.cancelConfirmKeysOnEmpty===!1&&e.preventDefault());var i=u.val().length;Math.ceil(i/5);u.attr("size",Math.max(this.inputSize,u.val().length))},h)),h.$container.on("click","[data-role=remove]",r.proxy(function(e){h.$element.attr("disabled")||h.remove(r(e.target).closest(".tag").data("item"))},h)),h.options.itemValue===k.itemValue&&("INPUT"===h.$element[0].tagName?h.add(h.$element.val()):r("option",h.$element).each(function(){h.add(r(this).attr("value"),!0)}))},destroy:function(){var b=this;b.$container.off("keypress","input"),b.$container.off("click","[role=remove]"),b.$container.remove(),b.$element.removeData("tagsinput"),b.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],d=this.$container[0];a&&a.parentNode!==d;){a=a.parentNode}return r(a)}},r.fn.tagsinput=function(h,g,b){var a=[];return this.each(function(){var d=r(this).data("tagsinput");if(d){if(h||g){if(void 0!==d[h]){if(3===d[h].length&&void 0!==b){var c=d[h](g,null,b)}else{var c=d[h](g)}void 0!==c&&a.push(c)}}else{a.push(d)}}else{d=new q(this,h),r(this).data("tagsinput",d),a.push(d),"SELECT"===this.tagName&&r("option",r(this)).attr("selected","selected"),r(this).val(r(this).val())}}),"string"==typeof h?a.length>1?a:a[0]:a},r.fn.tagsinput.Constructor=q;var j=r("<div />");r(function(){r("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);