/*!
 * jQuery Stepy - A Wizard Plugin
 * --------------------------------------------------------------
 *
 * jQuery Stepy is a plugin that generates a customizable wizard.
 *
 * Licensed under The MIT License
 *
 * @version        1.1.0
 * @since          2010-07-03
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 *
 * --------------------------------------------------------------
 *
 *  <form>
 *    <fieldset title="Step 1">
 *      <legend>description one</legend>
 *      <!-- inputs -->
 *    </fieldset>
 *
 *    <fieldset title="Step 2">
 *      <legend>description two</legend>
 *      <!-- inputs -->
 *    </fieldset>
 *
 *    <input type="submit" />
 *  </form>
 *
 *  $('form').stepy();
 *
 */
;(function(b){var a={init:function(c){return this.each(function(){a.destroy.call(this);this.opt=b.extend({},b.fn.stepy.defaults,c);var d=this,e=b(this),f=e.attr("id");if(f===undefined||f===""){var f=a._hash.call(d);e.attr("id",f)}if(d.opt.validate){jQuery.validator.setDefaults({ignore:d.opt.ignore});e.append('<div class="stepy-errors" />')}d.header=a._header.call(d);d.steps=e.children("fieldset");d.steps.each(function(g){a._createHead.call(d,this,g);a._createButtons.call(d,this,g)});d.heads=d.header.children("li");d.heads.first().addClass("stepy-active");if(d.opt.finishButton){a._bindFinish.call(d)}if(d.opt.titleClick){d.heads.click(function(){var i=d.heads.filter(".stepy-active").attr("id").split("-"),h=parseInt(i[i.length-1],10),g=b(this).index();if(g>h){if(d.opt.next&&!a._execute.call(e,d.opt.next,g)){return false}}else{if(g<h){if(d.opt.back&&!a._execute.call(e,d.opt.back,g)){return false}}}if(g!=h){a.step.call(d,(g)+1)}})}else{d.heads.css("cursor","default")}if(d.opt.enter){a._bindEnter.call(d)}d.steps.first().find(":input:visible:enabled").first().select().focus();e.data({settings:this.opt,stepy:true})})},_bindEnter:function(){var c=this;c.steps.delegate('input[type="text"], input[type="password"]',"keypress",function(d){var e=(d.keyCode?d.keyCode:d.which);if(e==13){d.preventDefault();var g=b(this).closest("fieldset").find(".stepy-navigator");if(g.length){var f=g.children(".button-next");if(f.length){f.click()}else{if(c.finish){c.finish.click()}}}}})},_bindFinish:function(){var c=this,e=b(this),d=e.children('input[type="submit"]');c.finish=(d.length===1)?d:e.children(".stepy-finish");if(c.finish.length){var f=e.is("form"),g=undefined;if(f&&c.opt.finish){g=e.attr("onsubmit");e.attr("onsubmit","return false;")}c.finish.on("click.stepy",function(h){if(c.opt.finish&&!a._execute.call(e,c.opt.finish,c.steps.length-1)){h.preventDefault()}else{if(f){if(g){e.attr("onsubmit",g)}else{e.removeAttr("onsubmit")}var i=c.finish.attr("type")==="submit";if(!i&&(!c.opt.validate||a.validate.call(e,c.steps.length-1))){e.submit()}}}});c.steps.last().children(".stepy-navigator").append(c.finish)}else{b.error('Submit button or element with class "stepy-finish" missing!')}},_createBackButton:function(g,e){var d=this,f=b(this),c={href:"#","class":"button-back",html:d.opt.backLabel};b("<a />",c).on("click.stepy",function(h){h.preventDefault();if(!d.opt.back||a._execute.call(d,d.opt.back,e-1)){a.step.call(d,(e-1)+1)}}).appendTo(g)},_createButtons:function(d,c){var e=a._navigator.call(this).appendTo(d);if(c===0){if(this.steps.length>1){a._createNextButton.call(this,e,c)}}else{b(d).hide();a._createBackButton.call(this,e,c);if(c<this.steps.length-1){a._createNextButton.call(this,e,c)}}},_createHead:function(e,c){var e=b(e).attr("id",b(this).attr("id")+"-step-"+c).addClass("stepy-step"),d=a._head.call(this,c);d.append(a._title.call(this,e));if(this.opt.description){d.append(a._description.call(this,e))}this.header.append(d)},_createNextButton:function(g,e){var d=this,f=b(this),c={href:"#","class":"button-next",html:d.opt.nextLabel};b("<a/>",c).on("click.stepy",function(h){h.preventDefault();if(!d.opt.next||a._execute.call(f,d.opt.next,e+1)){a.step.call(d,(e+1)+1)}}).appendTo(g)},_description:function(d){var c=d.children("legend");if(!this.opt.legend){c.hide()}if(c.length){return b("<span />",{html:c.html()})}a._error.call(this,"<legend /> element missing!")},_error:function(c){b(this).html(c);b.error(c)},_execute:function(e,c){var d=e.call(this,c+1);return d||d===undefined},_hash:function(){this.hash="stepy-"+Math.random().toString().substring(2);return this.hash},_head:function(c){return b("<li />",{id:b(this).attr("id")+"-head-"+c})},_header:function(){var c=b("<ul />",{id:b(this).attr("id")+"-header","class":"stepy-header"});if(this.opt.titleTarget){c.appendTo(this.opt.titleTarget)}else{c.insertBefore(this)}return c},_navigator:function(c){return b('<div class="stepy-navigator" />')},_title:function(c){return b("<div />",{html:c.attr("title")||"--"})},destroy:function(){return b(this).each(function(){var d=b(this);if(d.data("stepy")){var c=d.data("stepy",false).children("fieldset").css("display","");d.children(".stepy-errors").remove();this.finish.appendTo(c.last());c.find("p.stepy-navigator").remove()}})},step:function(g){var e=this;that=b(this),opt=that[0].opt;g--;var d=that.children("fieldset");if(g>d.length-1){g=d.length-1}var c=g;if(opt.validate){var k=true;for(var h=0;h<g;h++){k&=a.validate.call(this,h);if(opt.block&&!k){c=h;break}}}var j=d.length;if(opt.transition=="fade"){d.fadeOut(opt.duration,function(){if(--j>0){return}d.eq(c).fadeIn(opt.duration)})}else{if(opt.transition=="slide"){d.slideUp(opt.duration,function(){if(--j>0){return}d.eq(c).slideDown(opt.duration)})}else{d.hide(opt.duration).eq(c).show(opt.duration)}}that[0].heads.removeClass("stepy-active").eq(c).addClass("stepy-active");if(that.is("form")){var f=undefined;if(c==g){f=d.eq(c).find(":input:enabled:visible")}else{f=d.eq(c).find(".error").select().focus()}f.first().select().focus()}if(opt.select){opt.select.call(this,c+1)}return that},validate:function(d){var g=b(this);if(!g.is("form")){return true}var c=this,f=g.children("fieldset").eq(d),i=true,e=b("#"+g.attr("id")+"-header").children().eq(d),h=g.validate();b(f.find(":input:enabled").get().reverse()).each(function(){var j=h.element(b(this));if(j===undefined){j=true}i&=j;if(i){if(c.opt.errorImage){e.removeClass("stepy-error")}}else{if(c.opt.errorImage){e.addClass("stepy-error")}h.focusInvalid()}});return i}};b.fn.stepy=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not exist!")}}};b.fn.stepy.defaults={back:undefined,backLabel:"&lt; Back",block:false,description:true,duration:undefined,enter:true,errorImage:false,finish:undefined,finishButton:true,ignore:"",legend:true,next:undefined,nextLabel:"Next &gt;",select:undefined,titleClick:false,titleTarget:undefined,transition:undefined,validate:false}})(jQuery);